name: Generate md5 sums
on: [push]
jobs:
  Retrieve-Firmware:
    runs-on: ubuntu-latest
    steps:
      - name: Free up disk space for the CI
        if: false
        uses: AdityaGarg8/remove-unwanted-software@v4
        with:
          remove-android: 'true'
          remove-dotnet: 'true'
          remove-haskell: 'true'
          remove-codeql: 'true'
          remove-docker-images: 'true'
          remove-large-packages: 'true'
          remove-cached-tools: 'true'
          remove-swapfile: 'true'
          verbose: 'false'

      - name: 'Checkout Repo'
        uses: actions/checkout@v4

      - name: Get kconfig
        run: |
          DOCKER_IMAGE=debian:sid
          docker pull ${DOCKER_IMAGE}
          docker run \
          -t \
          -v "$(pwd)":/repo \
          ${DOCKER_IMAGE} \
          /bin/bash -c 'cd /repo && \
          apt-get update && apt install -y build-essential fakeroot libncurses-dev bison flex libssl-dev libelf-dev \
          openssl dkms libudev-dev libpci-dev libiberty-dev autoconf wget xz-utils git \
          libcap-dev bc rsync cpio debhelper kernel-wedge curl gawk dwarves zstd python3 sparse gcc-13 && \
          git config --global --add safe.directory /repo && \
          git clone https://github.com/intel/lkp-tests.git ~/lkp-tests && \
          gcc --version && \
          git remote add hid https://git.kernel.org/pub/scm/linux/kernel/git/hid/hid.git && \
          git fetch --no-tags hid for-6.15/apple && \
          git checkout 8e9b9152cfbdc2a90a8acb68acbc1407ef67d139 && \
          curl -L https://download.01.org/0day-ci/archive/20250209/202502091105.ZsLoBSIh-lkp@intel.com/config > config && \
          mkdir build_dir && cp config build_dir/.config && \
          COMPILER_INSTALL_PATH=$HOME/0day COMPILER=gcc-13.3.0 ~/lkp-tests/kbuild/make.cross C=1 CF='-fdiagnostic-prefix -D__CHECK_ENDIAN__ -fmax-errors=unlimited -fmax-warnings=unlimited' O=build_dir ARCH=arc olddefconfig && \
          COMPILER_INSTALL_PATH=$HOME/0day COMPILER=gcc-13.3.0 ~/lkp-tests/kbuild/make.cross C=1 CF='-fdiagnostic-prefix -D__CHECK_ENDIAN__ -fmax-errors=unlimited -fmax-warnings=unlimited' O=build_dir ARCH=arc SHELL=/bin/bash drivers/hid/'
        env:
          GH_TOKEN: ${{ secrets.PAT }}
      - name: Upload package artifact
        if: false
        uses: actions/upload-artifact@v4
        with:
          name: config
          #path: /boot/config*
      - name: Release
        if: github.ref == 'refs/heads/LTS'
        uses: softprops/action-gh-release@v2
        with:
          #files: ${{ github.workspace }}/ISO/*.tar.gz
          #files: ${{ github.workspace }}/ISO/*.iso
          files: ${{ github.workspace }}/output/*
          tag_name: horizon
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
